{"ast":null,"code":"import _objectSpread from\"C:/Users/Naor/Desktop/code/Summer Projects/SocialPlace/social/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/Naor/Desktop/code/Summer Projects/SocialPlace/social/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import*as React from'react';import List from'@mui/material/List';import{useEffect,useState}from\"react\";import api from\"../api/axios\";import ListSubheader from'@mui/material/ListSubheader';import{useSelector,useDispatch}from'react-redux';import{setUpdate}from'../features/feedSlice';import{setAlertMsg}from'../features/authSlice';import Friend from'./Friend';import{registerMessageHandler,unregisterMessageHandler,sendMessage}from'../api/socketManager';import{jsx as _jsx}from\"react/jsx-runtime\";export default function Friends(_ref){var removeFriend=_ref.removeFriend,navigate=_ref.navigate;var userOb=useSelector(function(state){var _state$auth;return(_state$auth=state.auth)===null||_state$auth===void 0?void 0:_state$auth.userOb;});var userID=userOb._id;var dispatch=useDispatch();var _useState=useState(),_useState2=_slicedToArray(_useState,2),friends=_useState2[0],setFriends=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),refresh=_useState4[0],setRefresh=_useState4[1];var update=useSelector(function(state){var _state$feed;return(_state$feed=state.feed)===null||_state$feed===void 0?void 0:_state$feed.update;});useEffect(function(){api.get(\"/getfriends\",{params:{user:userID}}).then(function(res){var friends=res.data;var friendsIds=friends===null||friends===void 0?void 0:friends.map(function(friend){return friend._id;});sendMessage('checkOnline',friendsIds,function(response){var updatedFriends=friends===null||friends===void 0?void 0:friends.map(function(friend){if(response.includes(friend._id)){return _objectSpread(_objectSpread({},friend),{},{online:true});}return friend;});setFriends(updatedFriends);setRefresh(!refresh);});}).catch(function(err){console.log(\"Error: \",err);});var handleConnect=function handleConnect(data){var userId=data;var updatedFriends=friends===null||friends===void 0?void 0:friends.map(function(friend){if(friend._id===userId){return _objectSpread(_objectSpread({},friend),{},{online:true});}return friend;});setFriends(updatedFriends);setRefresh(!refresh);dispatch(setUpdate());};var handleDisconnect=function handleDisconnect(data){var userId=data;var updatedFriends=friends===null||friends===void 0?void 0:friends.map(function(friend){if(friend._id===userId){return _objectSpread(_objectSpread({},friend),{},{online:false});}return friend;});setFriends(updatedFriends);setRefresh(!refresh);dispatch(setUpdate());};registerMessageHandler('online',handleConnect);registerMessageHandler('offline',handleDisconnect);return function(){unregisterMessageHandler('online');unregisterMessageHandler('offline');};},[update]);return/*#__PURE__*/_jsx(List,{className:\"shadow-3\",dense:true,sx:{width:'100%',maxWidth:360,bgcolor:'background.paper',borderRadius:'20px',overflow:'hidden'},subheader:/*#__PURE__*/_jsx(ListSubheader,{children:\"Friends\"}),children:friends===null||friends===void 0?void 0:friends.map(function(value){return/*#__PURE__*/_jsx(Friend,{friend:value,navigate:navigate,removeFriend:removeFriend},value._id);})});}","map":{"version":3,"names":["React","List","useEffect","useState","api","ListSubheader","useSelector","useDispatch","setUpdate","setAlertMsg","Friend","registerMessageHandler","unregisterMessageHandler","sendMessage","jsx","_jsx","Friends","_ref","removeFriend","navigate","userOb","state","_state$auth","auth","userID","_id","dispatch","_useState","_useState2","_slicedToArray","friends","setFriends","_useState3","_useState4","refresh","setRefresh","update","_state$feed","feed","get","params","user","then","res","data","friendsIds","map","friend","response","updatedFriends","includes","_objectSpread","online","catch","err","console","log","handleConnect","userId","handleDisconnect","className","dense","sx","width","maxWidth","bgcolor","borderRadius","overflow","subheader","children","value"],"sources":["C:/Users/Naor/Desktop/code/Summer Projects/SocialPlace/social/src/components/Friends.js"],"sourcesContent":["import * as React from 'react';\r\nimport List from '@mui/material/List';\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport api from \"../api/axios\";\r\nimport ListSubheader from '@mui/material/ListSubheader';\r\n\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { setUpdate } from '../features/feedSlice';\r\nimport { setAlertMsg } from '../features/authSlice';\r\nimport Friend from './Friend';\r\nimport { registerMessageHandler, unregisterMessageHandler, sendMessage } from '../api/socketManager';\r\n\r\n\r\nexport default function Friends({ removeFriend, navigate }) {\r\n    const userOb = useSelector((state) => state.auth?.userOb);\r\n    const userID = userOb._id;\r\n    const dispatch = useDispatch();\r\n    const [friends, setFriends] = useState()\r\n    const [refresh, setRefresh] = useState(false)\r\n    const update = useSelector((state) => state.feed?.update);\r\n\r\n    useEffect(() => {\r\n        api\r\n            .get(\"/getfriends\", {\r\n                params: {\r\n                    user: userID,\r\n                },\r\n            }).then((res) => {\r\n                const friends = res.data;\r\n                const friendsIds = friends?.map(friend => friend._id);\r\n                sendMessage('checkOnline', friendsIds, (response) => {\r\n                    const updatedFriends = friends?.map(friend => {\r\n                        if (response.includes(friend._id)) {\r\n                            return {\r\n                                ...friend,\r\n                                online: true\r\n                            };\r\n                        }\r\n                        return friend;\r\n                    });\r\n                    setFriends(updatedFriends);\r\n                    setRefresh(!refresh);\r\n                });\r\n\r\n            }).catch((err) => {\r\n                console.log(\"Error: \", err);\r\n            });\r\n\r\n        const handleConnect = (data) => {\r\n            const userId = data;\r\n            const updatedFriends = friends?.map(friend => {\r\n                if (friend._id === userId) {\r\n                    return {\r\n                        ...friend,\r\n                        online: true\r\n                    };\r\n                }\r\n                return friend;\r\n            });\r\n            setFriends(updatedFriends);\r\n            setRefresh(!refresh);\r\n            dispatch(setUpdate());\r\n        }\r\n\r\n        const handleDisconnect = (data) => {\r\n            const userId = data;\r\n            const updatedFriends = friends?.map(friend => {\r\n                if (friend._id === userId) {\r\n                    return {\r\n                        ...friend,\r\n                        online: false\r\n                    };\r\n                }\r\n                return friend;\r\n            });\r\n            setFriends(updatedFriends);\r\n            setRefresh(!refresh);\r\n            dispatch(setUpdate());\r\n        }\r\n\r\n        registerMessageHandler('online', handleConnect);\r\n        registerMessageHandler('offline', handleDisconnect);\r\n\r\n        return () => {\r\n            unregisterMessageHandler('online');\r\n            unregisterMessageHandler('offline');\r\n        }\r\n\r\n    }\r\n        , [update]);\r\n\r\n\r\n    return (\r\n        <List className='shadow-3' dense sx={{ width: '100%', maxWidth: 360, bgcolor: 'background.paper', borderRadius: '20px', overflow: 'hidden' }}\r\n            subheader={<ListSubheader>Friends</ListSubheader>}>\r\n            {friends?.map((value) => {\r\n                return <Friend key={value._id} friend={value} navigate={navigate} removeFriend={removeFriend} />\r\n            })}\r\n        </List>\r\n    );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}