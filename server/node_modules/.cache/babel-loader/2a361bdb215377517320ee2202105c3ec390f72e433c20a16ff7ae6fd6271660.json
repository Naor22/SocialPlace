{"ast":null,"code":"import _slicedToArray from\"C:/Users/Naor/Desktop/code/Summer Projects/SocialPlace/social/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import ListItemText from'@mui/material/ListItemText';import ListItemAvatar from'@mui/material/ListItemAvatar';import Avatar from'@mui/material/Avatar';import Typography from'@mui/material/Typography';import ListItem from'@mui/material/ListItem';import{useEffect,useState}from'react';import{sendMessage}from'../api/socketManager';import{setCurrentChat,setCurrentChatContent}from'../features/chatSlice';import{useDispatch,useSelector}from'react-redux';import Divider from'@mui/material/Divider';import ListItemButton from'@mui/material/ListItemButton';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ChatUnit=function ChatUnit(_ref){var user=_ref.user,friend=_ref.friend,isSelected=_ref.isSelected,onSelect=_ref.onSelect;var dispatch=useDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),userHasInteracted=_useState2[0],setUserHasInteracted=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),chatContent=_useState4[0],setChatContent=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),chatId=_useState6[0],setChatId=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),chatUpdate=_useState8[0],setChatUpdate=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),dataFetched=_useState12[0],setDataFetched=_useState12[1];var _useState13=useState({userId:null,content:null,created_at:null}),_useState14=_slicedToArray(_useState13,2),lastMessage=_useState14[0],setLastMessage=_useState14[1];var chatContentSelector=useSelector(function(state){return state.chat.currentChatContent;});var currentChat=useSelector(function(state){return state.chat.currentChat;});useEffect(function(){dispatch(setCurrentChat(null));sendMessage('checkChats',{userId:user._id,friendId:friend._id},function(response){if(response.data.users.some(function(user){return user._id==friend._id;}))if(response.success){var _response$data;if(userHasInteracted)setChatId(response.data);if(((_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.messages.length)>=1){var _response$data$messag=response.data.messages[response.data.messages.length-1],userId=_response$data$messag.userId,content=_response$data$messag.content,created_at=_response$data$messag.created_at;setChatContent(response.data.messages);setLastMessage({userId:userId,content:content,created_at:created_at});}setDataFetched(true);}});setLoading(false);},[chatUpdate,userHasInteracted]);useEffect(function(){if(dataFetched&&chatId){dispatch(setCurrentChat(chatId));dispatch(setCurrentChatContent(chatContent));setDataFetched(false);}},[dataFetched,chatId,chatContent,dispatch]);var handleClick=function handleClick(){setUserHasInteracted(true);setChatUpdate(function(prev){return!prev;});onSelect();};return/*#__PURE__*/_jsxs(ListItem,{alignItems:\"flex-start\",onClick:function onClick(){return handleClick();},style:{backgroundColor:isSelected?'lightgray':'transparent',borderRadius:'10px'},children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{alt:friend.name,src:friend.avatar})}),/*#__PURE__*/_jsx(ListItemText,{primary:friend.name,secondary:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{sx:{display:'inline'},component:\"span\",variant:\"body2\",color:\"text.primary\",children:lastMessage.userId===null?\"\":friend.name}),lastMessage.userId===null?\"Start a chat with \"+friend.name:\" : \"+lastMessage.content]})})]},friend._id);};export default ChatUnit;","map":{"version":3,"names":["ListItemText","ListItemAvatar","Avatar","Typography","ListItem","useEffect","useState","sendMessage","setCurrentChat","setCurrentChatContent","useDispatch","useSelector","Divider","ListItemButton","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ChatUnit","_ref","user","friend","isSelected","onSelect","dispatch","_useState","_useState2","_slicedToArray","userHasInteracted","setUserHasInteracted","_useState3","_useState4","chatContent","setChatContent","_useState5","_useState6","chatId","setChatId","_useState7","_useState8","chatUpdate","setChatUpdate","_useState9","_useState10","loading","setLoading","_useState11","_useState12","dataFetched","setDataFetched","_useState13","userId","content","created_at","_useState14","lastMessage","setLastMessage","chatContentSelector","state","chat","currentChatContent","currentChat","_id","friendId","response","data","users","some","success","_response$data","messages","length","_response$data$messag","handleClick","prev","alignItems","onClick","style","backgroundColor","borderRadius","children","alt","name","src","avatar","primary","secondary","sx","display","component","variant","color"],"sources":["C:/Users/Naor/Desktop/code/Summer Projects/SocialPlace/social/src/components/ChatUnit.js"],"sourcesContent":["import ListItemText from '@mui/material/ListItemText';\r\nimport ListItemAvatar from '@mui/material/ListItemAvatar';\r\nimport Avatar from '@mui/material/Avatar';\r\nimport Typography from '@mui/material/Typography';\r\nimport ListItem from '@mui/material/ListItem';\r\nimport { useEffect, useState } from 'react'\r\nimport { sendMessage } from '../api/socketManager'\r\nimport { setCurrentChat, setCurrentChatContent } from '../features/chatSlice';\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport Divider from '@mui/material/Divider';\r\nimport ListItemButton from '@mui/material/ListItemButton';\r\n\r\n\r\n\r\nconst ChatUnit = ({ user, friend, isSelected, onSelect }) => {\r\n    const dispatch = useDispatch()\r\n    const [userHasInteracted, setUserHasInteracted] = useState(false);\r\n    const [chatContent, setChatContent] = useState([])\r\n    const [chatId, setChatId] = useState(null)\r\n    const [chatUpdate, setChatUpdate] = useState(false)\r\n    const [loading, setLoading] = useState(true);\r\n    const [dataFetched, setDataFetched] = useState(false);\r\n    const [lastMessage, setLastMessage] = useState({\r\n        userId: null,\r\n        content: null,\r\n        created_at: null\r\n    })\r\n    const chatContentSelector = useSelector(state => state.chat.currentChatContent)\r\n    const currentChat = useSelector(state => state.chat.currentChat)\r\n    useEffect(() => {\r\n        dispatch(setCurrentChat(null));\r\n        sendMessage('checkChats', { userId: user._id, friendId: friend._id }, (response) => {\r\n            \r\n            if (response.data.users.some(user => user._id == friend._id))\r\n                if (response.success) {\r\n\r\n                    if (userHasInteracted)\r\n                        setChatId(response.data);\r\n\r\n                    if (response.data?.messages.length >= 1) {\r\n              \r\n                        const { userId, content, created_at } = response.data.messages[response.data.messages.length - 1];\r\n                        setChatContent(response.data.messages);\r\n                        setLastMessage({ userId, content, created_at });\r\n\r\n\r\n                    }\r\n                    setDataFetched(true);\r\n\r\n\r\n                }\r\n\r\n        });\r\n\r\n        setLoading(false);\r\n    }, [chatUpdate, userHasInteracted]);\r\n\r\n    useEffect(() => {\r\n        if (dataFetched && chatId) {\r\n            dispatch(setCurrentChat(chatId));\r\n            dispatch(setCurrentChatContent(chatContent));\r\n            setDataFetched(false);\r\n        }\r\n    }, [dataFetched, chatId, chatContent, dispatch]);\r\n    const handleClick = () => {\r\n        setUserHasInteracted(true);\r\n        setChatUpdate(prev => !prev);\r\n        onSelect();\r\n    };\r\n\r\n\r\n\r\n\r\n    return (\r\n\r\n        <ListItem key={friend._id} alignItems=\"flex-start\" onClick={() => handleClick()} style={{ backgroundColor: isSelected ? 'lightgray' : 'transparent', borderRadius: '10px' }} >\r\n\r\n            <ListItemAvatar >\r\n                <Avatar alt={friend.name} src={friend.avatar} />\r\n            </ListItemAvatar>\r\n            <ListItemText\r\n                primary={friend.name}\r\n                secondary={\r\n\r\n                    <>\r\n\r\n                        <Typography\r\n                            sx={{ display: 'inline' }}\r\n                            component=\"span\"\r\n                            variant=\"body2\"\r\n                            color=\"text.primary\"\r\n                        >\r\n\r\n                            {lastMessage.userId === null ? \"\" : friend.name}\r\n                        </Typography>\r\n                        {lastMessage.userId === null ? \"Start a chat with \" + friend.name : \" : \" + lastMessage.content}\r\n\r\n                    </>\r\n\r\n                }\r\n            />\r\n\r\n        </ListItem>\r\n\r\n    )\r\n}\r\nexport default ChatUnit;"],"mappings":"mJAAA,MAAO,CAAAA,YAAY,KAAM,4BAA4B,CACrD,MAAO,CAAAC,cAAc,KAAM,8BAA8B,CACzD,MAAO,CAAAC,MAAM,KAAM,sBAAsB,CACzC,MAAO,CAAAC,UAAU,KAAM,0BAA0B,CACjD,MAAO,CAAAC,QAAQ,KAAM,wBAAwB,CAC7C,OAASC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC3C,OAASC,WAAW,KAAQ,sBAAsB,CAClD,OAASC,cAAc,CAAEC,qBAAqB,KAAQ,uBAAuB,CAC7E,OAASC,WAAW,CAAEC,WAAW,KAAQ,aAAa,CACtD,MAAO,CAAAC,OAAO,KAAM,uBAAuB,CAC3C,MAAO,CAAAC,cAAc,KAAM,8BAA8B,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,QAAA,IAAAC,SAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAI1D,GAAM,CAAAC,QAAQ,CAAG,QAAX,CAAAA,QAAQA,CAAAC,IAAA,CAA+C,IAAzC,CAAAC,IAAI,CAAAD,IAAA,CAAJC,IAAI,CAAEC,MAAM,CAAAF,IAAA,CAANE,MAAM,CAAEC,UAAU,CAAAH,IAAA,CAAVG,UAAU,CAAEC,QAAQ,CAAAJ,IAAA,CAARI,QAAQ,CAClD,GAAM,CAAAC,QAAQ,CAAGhB,WAAW,CAAC,CAAC,CAC9B,IAAAiB,SAAA,CAAkDrB,QAAQ,CAAC,KAAK,CAAC,CAAAsB,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA1DG,iBAAiB,CAAAF,UAAA,IAAEG,oBAAoB,CAAAH,UAAA,IAC9C,IAAAI,UAAA,CAAsC1B,QAAQ,CAAC,EAAE,CAAC,CAAA2B,UAAA,CAAAJ,cAAA,CAAAG,UAAA,IAA3CE,WAAW,CAAAD,UAAA,IAAEE,cAAc,CAAAF,UAAA,IAClC,IAAAG,UAAA,CAA4B9B,QAAQ,CAAC,IAAI,CAAC,CAAA+B,UAAA,CAAAR,cAAA,CAAAO,UAAA,IAAnCE,MAAM,CAAAD,UAAA,IAAEE,SAAS,CAAAF,UAAA,IACxB,IAAAG,UAAA,CAAoClC,QAAQ,CAAC,KAAK,CAAC,CAAAmC,UAAA,CAAAZ,cAAA,CAAAW,UAAA,IAA5CE,UAAU,CAAAD,UAAA,IAAEE,aAAa,CAAAF,UAAA,IAChC,IAAAG,UAAA,CAA8BtC,QAAQ,CAAC,IAAI,CAAC,CAAAuC,WAAA,CAAAhB,cAAA,CAAAe,UAAA,IAArCE,OAAO,CAAAD,WAAA,IAAEE,UAAU,CAAAF,WAAA,IAC1B,IAAAG,WAAA,CAAsC1C,QAAQ,CAAC,KAAK,CAAC,CAAA2C,WAAA,CAAApB,cAAA,CAAAmB,WAAA,IAA9CE,WAAW,CAAAD,WAAA,IAAEE,cAAc,CAAAF,WAAA,IAClC,IAAAG,WAAA,CAAsC9C,QAAQ,CAAC,CAC3C+C,MAAM,CAAE,IAAI,CACZC,OAAO,CAAE,IAAI,CACbC,UAAU,CAAE,IAChB,CAAC,CAAC,CAAAC,WAAA,CAAA3B,cAAA,CAAAuB,WAAA,IAJKK,WAAW,CAAAD,WAAA,IAAEE,cAAc,CAAAF,WAAA,IAKlC,GAAM,CAAAG,mBAAmB,CAAGhD,WAAW,CAAC,SAAAiD,KAAK,QAAI,CAAAA,KAAK,CAACC,IAAI,CAACC,kBAAkB,GAAC,CAC/E,GAAM,CAAAC,WAAW,CAAGpD,WAAW,CAAC,SAAAiD,KAAK,QAAI,CAAAA,KAAK,CAACC,IAAI,CAACE,WAAW,GAAC,CAChE1D,SAAS,CAAC,UAAM,CACZqB,QAAQ,CAAClB,cAAc,CAAC,IAAI,CAAC,CAAC,CAC9BD,WAAW,CAAC,YAAY,CAAE,CAAE8C,MAAM,CAAE/B,IAAI,CAAC0C,GAAG,CAAEC,QAAQ,CAAE1C,MAAM,CAACyC,GAAI,CAAC,CAAE,SAACE,QAAQ,CAAK,CAEhF,GAAIA,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,IAAI,CAAC,SAAA/C,IAAI,QAAI,CAAAA,IAAI,CAAC0C,GAAG,EAAIzC,MAAM,CAACyC,GAAG,GAAC,CACxD,GAAIE,QAAQ,CAACI,OAAO,CAAE,KAAAC,cAAA,CAElB,GAAIzC,iBAAiB,CACjBS,SAAS,CAAC2B,QAAQ,CAACC,IAAI,CAAC,CAE5B,GAAI,EAAAI,cAAA,CAAAL,QAAQ,CAACC,IAAI,UAAAI,cAAA,iBAAbA,cAAA,CAAeC,QAAQ,CAACC,MAAM,GAAI,CAAC,CAAE,CAErC,IAAAC,qBAAA,CAAwCR,QAAQ,CAACC,IAAI,CAACK,QAAQ,CAACN,QAAQ,CAACC,IAAI,CAACK,QAAQ,CAACC,MAAM,CAAG,CAAC,CAAC,CAAzFpB,MAAM,CAAAqB,qBAAA,CAANrB,MAAM,CAAEC,OAAO,CAAAoB,qBAAA,CAAPpB,OAAO,CAAEC,UAAU,CAAAmB,qBAAA,CAAVnB,UAAU,CACnCpB,cAAc,CAAC+B,QAAQ,CAACC,IAAI,CAACK,QAAQ,CAAC,CACtCd,cAAc,CAAC,CAAEL,MAAM,CAANA,MAAM,CAAEC,OAAO,CAAPA,OAAO,CAAEC,UAAU,CAAVA,UAAW,CAAC,CAAC,CAGnD,CACAJ,cAAc,CAAC,IAAI,CAAC,CAGxB,CAER,CAAC,CAAC,CAEFJ,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAE,CAACL,UAAU,CAAEZ,iBAAiB,CAAC,CAAC,CAEnCzB,SAAS,CAAC,UAAM,CACZ,GAAI6C,WAAW,EAAIZ,MAAM,CAAE,CACvBZ,QAAQ,CAAClB,cAAc,CAAC8B,MAAM,CAAC,CAAC,CAChCZ,QAAQ,CAACjB,qBAAqB,CAACyB,WAAW,CAAC,CAAC,CAC5CiB,cAAc,CAAC,KAAK,CAAC,CACzB,CACJ,CAAC,CAAE,CAACD,WAAW,CAAEZ,MAAM,CAAEJ,WAAW,CAAER,QAAQ,CAAC,CAAC,CAChD,GAAM,CAAAiD,WAAW,CAAG,QAAd,CAAAA,WAAWA,CAAA,CAAS,CACtB5C,oBAAoB,CAAC,IAAI,CAAC,CAC1BY,aAAa,CAAC,SAAAiC,IAAI,QAAI,CAACA,IAAI,GAAC,CAC5BnD,QAAQ,CAAC,CAAC,CACd,CAAC,CAKD,mBAEIN,KAAA,CAACf,QAAQ,EAAkByE,UAAU,CAAC,YAAY,CAACC,OAAO,CAAE,SAAAA,QAAA,QAAM,CAAAH,WAAW,CAAC,CAAC,EAAC,CAACI,KAAK,CAAE,CAAEC,eAAe,CAAExD,UAAU,CAAG,WAAW,CAAG,aAAa,CAAEyD,YAAY,CAAE,MAAO,CAAE,CAAAC,QAAA,eAExKnE,IAAA,CAACd,cAAc,EAAAiF,QAAA,cACXnE,IAAA,CAACb,MAAM,EAACiF,GAAG,CAAE5D,MAAM,CAAC6D,IAAK,CAACC,GAAG,CAAE9D,MAAM,CAAC+D,MAAO,CAAE,CAAC,CACpC,CAAC,cACjBvE,IAAA,CAACf,YAAY,EACTuF,OAAO,CAAEhE,MAAM,CAAC6D,IAAK,CACrBI,SAAS,cAELrE,KAAA,CAAAF,SAAA,EAAAiE,QAAA,eAEInE,IAAA,CAACZ,UAAU,EACPsF,EAAE,CAAE,CAAEC,OAAO,CAAE,QAAS,CAAE,CAC1BC,SAAS,CAAC,MAAM,CAChBC,OAAO,CAAC,OAAO,CACfC,KAAK,CAAC,cAAc,CAAAX,QAAA,CAGnBzB,WAAW,CAACJ,MAAM,GAAK,IAAI,CAAG,EAAE,CAAG9B,MAAM,CAAC6D,IAAI,CACvC,CAAC,CACZ3B,WAAW,CAACJ,MAAM,GAAK,IAAI,CAAG,oBAAoB,CAAG9B,MAAM,CAAC6D,IAAI,CAAG,KAAK,CAAG3B,WAAW,CAACH,OAAO,EAEjG,CAEL,CACJ,CAAC,GAzBS/B,MAAM,CAACyC,GA2BZ,CAAC,CAGnB,CAAC,CACD,cAAe,CAAA5C,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}